<!DOCTYPE html>  <html> <head>   <title>i18n.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <ul id="jump_to">         <li>           <a class="large" href="javascript:void(0);">Jump To &hellip;</a>           <a class="small" href="javascript:void(0);">+</a>           <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="i18n-view-helper.html">                 i18n-view-helper.js               </a>                                           <a class="source" href="index.html">                 i18n.js               </a>                                           <a class="source" href="package.html">                 package.js               </a>                        </div>         </li>       </ul>          <ul class="sections">           <li id="title">             <div class="annotation">                 <h1>i18n.js</h1>             </div>         </li>                              <li id="section-1">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                           <p>A simple Meteor internationalization</p>

<p>@author Tarc√≠sio Gruppi <a href="&#109;&#x61;&#105;&#x6C;&#116;&#x6F;:&#116;x&#x67;&#x72;&#x75;&#112;&#x70;&#x69;&#x40;&#103;&#x6D;&#x61;&#105;&#x6C;&#x2E;&#x63;o&#x6D;">&#116;x&#x67;&#x72;&#x75;&#112;&#x70;&#x69;&#x40;&#103;&#x6D;&#x61;&#105;&#x6C;&#x2E;&#x63;o&#x6D;</a> <br />
@version 0.1.3 <br />
@date 2013-01-01</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div></div>                      </li>                              <li id="section-2">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                           

<p>The I18n class constructor</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">I18n</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>                      </li>                              <li id="section-3">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>                           

<p>Initialize the I18n instance</p>

<p>@param object options</p>

<p>Options: <br />
  <code>string defaultLang</code> The default language to use. <br />
  <code>boolean allowClientOperations</code> Allow clients to insert, update or remove. <br />
  <code>string collectionName</code> The name of the collection used to store the strings.</p>

<p>@return I18n <code>this</code></p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">I18n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">defaultLang</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">defaultLang</span> <span class="o">||</span> <span class="s1">&#39;en&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">allowClientOperations</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">allowClientOperations</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collectionName</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">collectionName</span> <span class="o">||</span> <span class="s1">&#39;i18n&#39;</span><span class="p">;</span></pre></div></div>                      </li>                              <li id="section-4">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>                           

<p>Create the collection</p>

             </div>                          <div class="content"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collectionName</span><span class="p">);</span></pre></div></div>                      </li>                              <li id="section-5">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>                           

<p>Publish the selected language</p>

             </div>                          <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;current_language_records&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span><span class="nx">lang</span><span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div></div>                      </li>                              <li id="section-6">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                           

<p>Block client operations if <code>this.allowClientOperations === false</code></p>

             </div>                          <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowClientOperations</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">retFalse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="kc">false</span><span class="p">;};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">allow</span><span class="p">({</span>
          <span class="nx">insert</span><span class="o">:</span> <span class="nx">retFalse</span><span class="p">,</span>
          <span class="nx">update</span><span class="o">:</span> <span class="nx">retFalse</span><span class="p">,</span>
          <span class="nx">remove</span><span class="o">:</span> <span class="nx">retFalse</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div></div>                      </li>                              <li id="section-7">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>                           

<p>Subscribe to the selected language</p>

             </div>                          <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">autosubscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">Meteor</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;current_language_records&quot;</span><span class="p">,</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_language&quot;</span><span class="p">));</span>
      <span class="p">});</span></pre></div></div>                      </li>                              <li id="section-8">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                           

<p>Set the current langauge to the default language</p>

             </div>                          <div class="content"><div class="highlight"><pre>      <span class="nx">Session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_language&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultLang</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>                      </li>                              <li id="section-9">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                           

<p>Insert a string to be translated</p>

<p>This method have 3 signatures</p>

<p>@param string lang The target language <br />
@param string baseStr The base string <br />
@param string newStr The translated string</p>

<p>@param string lang The target language <br />
@param array baseStr An array where each element is a array <code>[baseStr, newStr]</code></p>

<p>@param string lang The target language <br />
@param object baseStr An object with <code>baseStr</code> as key and <code>newStr</code> as value</p>

<p>@throws</p>

<p>@return I18n <code>this</code></p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">I18n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">baseStr</span><span class="p">,</span> <span class="nx">newStr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">baseStr</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">base_str</span><span class="o">:</span><span class="nx">baseStr</span><span class="p">,</span> <span class="nx">new_str</span><span class="o">:</span><span class="nx">newStr</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">baseStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">baseStr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
        <span class="nx">Meteor</span><span class="p">.</span><span class="nx">I18n</span><span class="p">().</span><span class="nx">insert</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">baseStr</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">baseStr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Meteor</span><span class="p">.</span><span class="nx">I18n</span><span class="p">().</span><span class="nx">insert</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">baseStr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span>
      <span class="k">throw</span> <span class="s1">&#39;Expected string|object|array. Got: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">str</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>                      </li>                              <li id="section-10">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                           

<p>Remove a string or an entire language</p>

<p>This method have 2 signatures</p>

<p>@param string lang The target language <br />
@param string baseStr The base string</p>

<p>@param string lang The target language <br />
@param array baseStr An array where each element is a string <code>baseStr</code></p>

<p>@throws</p>

<p>@return I18n <code>this</code></p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">I18n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">baseStr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">baseStr</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span><span class="nx">lang</span><span class="p">});</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">baseStr</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">base_str</span><span class="o">:</span><span class="nx">baseStr</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">baseStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">baseStr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
        <span class="nx">Meteor</span><span class="p">.</span><span class="nx">I18n</span><span class="p">().</span><span class="nx">remove</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span>
      <span class="k">throw</span> <span class="s1">&#39;Expected string|array. Got: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">str</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>                      </li>                              <li id="section-11">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                           

<p>Get or set the current language <br />
Use a Session var to store the current language and redraw all templates when changed</p>

<p>Set: <br />
@param string lang The target language</p>

<p>@return I18n <code>this</code></p>

<p>Get: <br />
@param void</p>

<p>@return string The current language</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">I18n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lang</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_language&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="nx">Session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_language&quot;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>                      </li>                              <li id="section-12">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>                           

<p>Translate a string <br />
Translate the string based on the current language</p>

<p>@param string str The <code>baseStr</code></p>

<p>@return string The <code>newStr</code> if found or the <code>baseStr</code> if not</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">I18n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span><span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_language&quot;</span><span class="p">),</span> <span class="nx">base_str</span><span class="o">:</span> <span class="nx">str</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">row</span> <span class="o">&amp;&amp;</span> <span class="nx">row</span><span class="p">.</span><span class="nx">new_str</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">row</span><span class="p">.</span><span class="nx">new_str</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div></div>                      </li>                              <li id="section-13">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                           

<p>Singleton</p>

<p>@see <code>I18n.prototype.init</code></p>             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">I18n</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">)</span>
      <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">I18n</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">})();</span>

</pre></div></div>                      </li>              </ul>    </div> </body> </html> 